# 使用 Cursor 为个人网站添加编辑功能指南

本指南将帮助您使用 Cursor 为个人网站（personal-portfolio）添加编辑文章和项目的功能。

## 📋 目录

1. [快速开始](#快速开始)
2. [功能概述](#功能概述)
3. [完整提示词](#完整提示词)
4. [分步实现](#分步实现)
5. [常见问题](#常见问题)

---

## 🚀 快速开始

### 第 1 步：准备项目

在 Cursor 中打开您的个人网站项目：

```bash
cd /home/ubuntu/personal-portfolio
```

### 第 2 步：复制提示词

从下面的"完整提示词"部分复制相应的提示词，粘贴到 Cursor 聊天中。

### 第 3 步：让 Cursor 实现功能

Cursor 会自动修改相关文件并实现功能。

---

## 📚 功能概述

### 要添加的功能

#### 1. **文章编辑功能**
- ✅ 编辑已发布的文章
- ✅ 修改文章标题、描述、内容
- ✅ 保存草稿
- ✅ 删除文章
- ✅ 发布/取消发布文章

#### 2. **项目编辑功能**
- ✅ 编辑项目信息
- ✅ 修改项目标题、描述、角色、标签
- ✅ 上传/修改项目配图
- ✅ 删除项目
- ✅ 排序项目

#### 3. **用户界面**
- ✅ 编辑按钮（在文章/项目详情页）
- ✅ 编辑表单（Markdown 编辑器）
- ✅ 成功/失败提示
- ✅ 确认删除对话框

#### 4. **权限控制**
- ✅ 仅所有者（您）可以编辑
- ✅ 访客无法编辑
- ✅ 自动权限检查

---

## 💬 完整提示词

### 提示词 1：添加文章编辑功能

复制以下内容到 Cursor 聊天：

```
我想为我的个人网站（personal-portfolio）添加文章编辑功能。

需求：
1. 在文章详情页面添加"编辑"按钮（仅所有者可见）
2. 创建文章编辑页面 (/articles/:id/edit)
3. 编辑表单包含：
   - 文章标题（文本输入）
   - 文章描述（文本输入）
   - 文章内容（Markdown 编辑器）
   - 发布状态（开关）
   - 保存按钮
   - 取消按钮
   - 删除按钮（带确认）

4. 后端 API：
   - 更新文章：POST /api/trpc/articles.update
   - 删除文章：POST /api/trpc/articles.delete
   - 获取编辑权限检查

5. 前端功能：
   - 加载现有文章数据到表单
   - 实时预览（可选）
   - 保存成功/失败提示
   - 自动返回文章详情页

6. 权限控制：
   - 仅文章作者（所有者）可编辑
   - 其他用户访问编辑页面时显示"无权限"

实现步骤：
1. 修改 drizzle/schema.ts（如需要）
2. 在 server/db.ts 中添加 updateArticle 和 deleteArticle 函数
3. 在 server/routers.ts 中添加 articles.update 和 articles.delete 路由
4. 创建 client/src/pages/ArticleEdit.tsx 编辑页面
5. 修改 client/src/pages/ArticleDetail.tsx 添加编辑按钮
6. 修改 client/src/App.tsx 添加编辑路由
7. 编写测试用例

请使用 Tailwind CSS 和 shadcn/ui 组件保持设计一致性。
```

### 提示词 2：添加项目编辑功能

复制以下内容到 Cursor 聊天：

```
我想为我的个人网站（personal-portfolio）添加项目编辑功能。

需求：
1. 在项目详情页面添加"编辑"按钮（仅所有者可见）
2. 创建项目编辑页面 (/projects/:id/edit)
3. 编辑表单包含：
   - 项目标题（文本输入）
   - 项目描述（文本输入）
   - 我的角色（文本输入）
   - 项目内容（Markdown 编辑器）
   - 成就（多行文本）
   - 影响（多行文本）
   - 收获（多行文本）
   - 标签（可添加/删除）
   - 配图上传（可选）
   - 保存按钮
   - 取消按钮
   - 删除按钮（带确认）

4. 后端 API：
   - 更新项目：POST /api/trpc/projects.update
   - 删除项目：POST /api/trpc/projects.delete
   - 获取编辑权限检查

5. 前端功能：
   - 加载现有项目数据到表单
   - 实时预览（可选）
   - 保存成功/失败提示
   - 自动返回项目详情页

6. 权限控制：
   - 仅项目创建者（所有者）可编辑
   - 其他用户访问编辑页面时显示"无权限"

实现步骤：
1. 修改 drizzle/schema.ts（如需要）
2. 在 server/db.ts 中添加 updateProject 和 deleteProject 函数
3. 在 server/routers.ts 中添加 projects.update 和 projects.delete 路由
4. 创建 client/src/pages/ProjectEdit.tsx 编辑页面
5. 修改 client/src/pages/ProjectDetail.tsx 添加编辑按钮
6. 修改 client/src/App.tsx 添加编辑路由
7. 编写测试用例

请使用 Tailwind CSS 和 shadcn/ui 组件保持设计一致性。
```

### 提示词 3：添加 Markdown 编辑器组件

如果 Cursor 没有自动添加 Markdown 编辑器，使用这个提示词：

```
我需要为我的个人网站添加一个 Markdown 编辑器组件。

需求：
1. 创建 Markdown 编辑器组件：client/src/components/MarkdownEditor.tsx
2. 功能：
   - 左侧：Markdown 编辑区域（textarea）
   - 右侧：实时预览（Markdown 渲染）
   - 工具栏：加粗、斜体、标题、代码块、列表等快捷按钮
   - 响应式设计（移动端为上下布局）

3. Props：
   - value: string（当前内容）
   - onChange: (value: string) => void（内容变化回调）
   - placeholder?: string（占位符）

4. 使用库：
   - react-markdown 用于预览
   - lucide-react 用于图标

5. 样式：
   - 使用 Tailwind CSS
   - 编辑区和预览区各占 50% 宽度
   - 移动端时上下各占 100% 高度

请实现这个组件。
```

### 提示词 4：添加管理后台（可选）

如果您想要一个集中的管理后台来管理所有文章和项目：

```
我想为我的个人网站添加一个管理后台页面。

需求：
1. 创建管理后台页面：client/src/pages/Admin.tsx
2. 功能：
   - 文章管理列表（显示所有文章）
   - 项目管理列表（显示所有项目）
   - 留言管理列表（显示所有留言）
   - 每项都有编辑/删除按钮
   - 添加新文章/项目按钮

3. 表格显示：
   - 文章：标题、发布状态、创建日期、操作
   - 项目：标题、创建日期、操作
   - 留言：发件人、主题、状态、操作

4. 权限控制：
   - 仅所有者（admin）可访问
   - 其他用户访问时重定向到首页

5. 路由：
   - /admin
   - /admin/articles
   - /admin/projects
   - /admin/messages

请实现这个管理后台。
```

---

## 🔧 分步实现

### 方案 A：快速实现（推荐）

**适合：** 想快速添加编辑功能

1. **复制提示词 1** → 实现文章编辑
2. **复制提示词 2** → 实现项目编辑
3. **测试功能** → 确保一切正常
4. **部署** → 发布到生产环境

**预计时间：** 30-45 分钟

### 方案 B：完整实现

**适合：** 想要专业的管理后台

1. **复制提示词 1** → 实现文章编辑
2. **复制提示词 2** → 实现项目编辑
3. **复制提示词 3** → 添加 Markdown 编辑器
4. **复制提示词 4** → 添加管理后台
5. **测试所有功能** → 确保一切正常
6. **部署** → 发布到生产环境

**预计时间：** 1-2 小时

---

## 📝 使用 Cursor 的完整工作流

### 第 1 步：打开项目

```bash
# 在 Cursor 中打开项目
cd /home/ubuntu/personal-portfolio
```

### 第 2 步：复制提示词

从上面的"完整提示词"部分选择您需要的功能，复制提示词。

### 第 3 步：粘贴到 Cursor

在 Cursor 的聊天窗口中粘贴提示词，然后按 Enter。

### 第 4 步：等待 Cursor 实现

Cursor 会自动：
- 修改相关文件
- 创建新的组件和页面
- 添加后端 API
- 编写测试用例

### 第 5 步：测试功能

```bash
# 启动开发服务器
pnpm dev

# 在浏览器中测试编辑功能
# http://localhost:5173
```

### 第 6 步：提交更改

```bash
# 提交到 Git
git add .
git commit -m "Add article and project editing features"
git push
```

---

## 💡 常见问题

### Q1：我想修改编辑表单的字段怎么办？

**A：** 使用这个提示词：

```
我想修改文章编辑表单，添加/删除以下字段：
- 添加：标签（tags）字段
- 删除：发布状态字段

请更新 client/src/pages/ArticleEdit.tsx 和相关的后端 API。
```

### Q2：我想添加图片上传功能怎么办？

**A：** 使用这个提示词：

```
我想为项目编辑页面添加图片上传功能。

需求：
1. 添加图片上传输入
2. 显示上传进度
3. 上传到 S3（使用 storagePut 函数）
4. 在表单中显示已上传的图片预览
5. 支持替换/删除图片

请更新 client/src/pages/ProjectEdit.tsx。
```

### Q3：我想添加自动保存草稿功能怎么办？

**A：** 使用这个提示词：

```
我想为文章和项目编辑页面添加自动保存草稿功能。

需求：
1. 每 30 秒自动保存一次草稿到本地存储
2. 显示"已保存"提示
3. 用户离开页面时提示"有未保存的更改"
4. 返回编辑页面时恢复草稿

请更新编辑页面组件。
```

### Q4：如何确保只有我能编辑？

**A：** Cursor 会自动添加权限检查。确保：

1. 后端使用 `protectedProcedure`（需要登录）
2. 检查 `ctx.user.id` 是否与内容所有者相同
3. 前端检查 `useAuth()` 获取当前用户

### Q5：我想添加编辑历史记录怎么办？

**A：** 使用这个提示词：

```
我想为文章和项目添加编辑历史记录功能。

需求：
1. 创建 editHistory 表记录每次编辑
2. 显示编辑历史列表（谁、什么时候、改了什么）
3. 支持恢复到某个历史版本
4. 显示版本对比

请实现这个功能。
```

---

## 🎯 推荐的实现顺序

### 第 1 周
1. ✅ 添加文章编辑功能
2. ✅ 添加项目编辑功能
3. ✅ 测试和修复 bug

### 第 2 周
1. ✅ 添加 Markdown 编辑器
2. ✅ 改进编辑表单 UI
3. ✅ 添加图片上传

### 第 3 周
1. ✅ 添加管理后台
2. ✅ 添加自动保存草稿
3. ✅ 添加编辑历史记录

---

## 📚 相关文档

- [MAINTENANCE.md](./MAINTENANCE.md) - 网站维护指南
- [README.md](./README.md) - 项目介绍
- [DEVELOPMENT.md](./DEVELOPMENT.md) - 开发指南

---

## 🚀 下一步

1. **选择实现方案** - 快速实现或完整实现
2. **复制相应提示词** - 从上面的"完整提示词"部分
3. **粘贴到 Cursor** - 在 Cursor 聊天中粘贴
4. **等待实现** - Cursor 会自动完成
5. **测试功能** - 在浏览器中测试
6. **部署上线** - 发布到生产环境

祝您使用愉快！如有问题，请参考"常见问题"部分。
